<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Liquid Glass (No Drag)</title>

  <style>
    :root{
      --bg-url: url("https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1800&q=60");
      --glass-radius: 28px;
      --glass-blur: 10px;        /* blur Ø¯Ø§Ø®Ù„ Ø´ÛŒØ´Ù‡ (Ø±ÙˆÛŒ snapshot) */
      --backdrop-blur: 18px;     /* blur ÙˆØ§Ù‚Ø¹ÛŒ Ù¾Ø´Øª Ø´ÛŒØ´Ù‡ (Ø§Ú¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¨Ø´Ù‡) */
      --sat: 170%;
      --con: 115%;
      --tint: rgba(255,255,255,0.10); /* tint Ø±ÙˆÛŒ Ø´ÛŒØ´Ù‡ */
      --border: rgba(255,255,255,0.22);
      --shadow: rgba(0,0,0,0.30);

      /* Ø´Ø¯Øª refraction (displacement) */
      --disp: 22; /* px */
      --noise-opacity: 0.045;
      --highlight: rgba(255,255,255,0.45);
    }

    body.dark{
      --tint: rgba(0,0,0,0.22);
      --border: rgba(255,255,255,0.12);
      --shadow: rgba(0,0,0,0.55);
      --highlight: rgba(255,255,255,0.22);
      --sat: 155%;
      --con: 112%;
      --disp: 18;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: -apple-system,BlinkMacSystemFont,"SF Pro Text",sans-serif;
      color:#0b1220;

      background:
        radial-gradient(circle at 15% 20%, rgba(255,255,255,0.65), transparent 55%),
        radial-gradient(circle at 85% 10%, rgba(219,234,254,0.55), transparent 55%),
        radial-gradient(circle at 10% 90%, rgba(224,242,254,0.45), transparent 55%),
        var(--bg-url);
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 200vh;
      transition: color .25s ease;
    }
    body.dark{ color:#e7eefc; }

    main{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 160px;
    }
    h1{ margin: 10px 0 6px; font-size: 26px; letter-spacing: -0.2px; }
    p{ margin: 0 0 12px; opacity: .9; line-height: 1.6; }

    /* ===========================
       LIQUID GLASS CORE
       =========================== */
    .liquid-glass{
      position: relative;
      overflow: hidden;
      border-radius: var(--glass-radius);
      border: 1px solid var(--border);

      box-shadow:
        0 28px 70px var(--shadow),
        inset 0 1px 0 rgba(255,255,255,0.20),
        inset 0 -1px 0 rgba(255,255,255,0.06);

      /* blur ÙˆØ§Ù‚Ø¹ÛŒ Ù¾Ø´Øª Ø´ÛŒØ´Ù‡ (Ø§Ú¯Ù‡ Ø³Ø§Ù¾ÙˆØ±Øª Ø´ÙˆØ¯) */
      backdrop-filter: blur(var(--backdrop-blur)) saturate(var(--sat)) contrast(var(--con));
      -webkit-backdrop-filter: blur(var(--backdrop-blur)) saturate(var(--sat)) contrast(var(--con));
    }

    /* Ø§ÛŒÙ† Ù„Ø§ÛŒÙ‡ â€œØ§Ø³Ù†Ù¾â€ŒØ´Ø§Øªâ€ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡â€ŒØ³Øª Ú©Ù‡ Ø¨Ø§ JS Ù‡Ù…â€ŒØªØ±Ø§Ø² Ù…ÛŒØ´Ù‡ */
    .liquid-glass .glass-sample{
      position:absolute;
      inset:-40px; /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ù‡Ù†Ú¯Ø§Ù… displacement */
      background-image:
        radial-gradient(circle at 15% 20%, rgba(255,255,255,0.65), transparent 55%),
        radial-gradient(circle at 85% 10%, rgba(219,234,254,0.55), transparent 55%),
        radial-gradient(circle at 10% 90%, rgba(224,242,254,0.45), transparent 55%),
        var(--bg-url);
      background-size: cover;
      background-attachment: fixed;
      background-repeat: no-repeat;

      /* Ù„Ù†Ø²ÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø§ SVG filter */
      filter: url(#liquidGlass);

      /* ÛŒÚ© blur Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ø±Ù… Ø´Ø¯Ù† Ø´Ú©Ø³Øª Ù†ÙˆØ± */
      transform: translateZ(0);
      will-change: background-position, filter, transform;
    }

    /* tint + highlight Ø§Ù¾Ù„ÛŒ */
    .liquid-glass::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(120% 85% at 50% 0%,
          var(--highlight) 0%,
          rgba(255,255,255,0.10) 40%,
          transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,0.10), transparent 55%),
        linear-gradient(180deg, var(--tint), rgba(255,255,255,0.02));
      mix-blend-mode: screen;
      opacity: .9;
    }

    /* Ù†ÙˆÛŒØ² Ø®ÛŒÙ„ÛŒ Ø±ÛŒØ² (ØªÙØ§ÙˆØª Ø§ØµÙ„ÛŒ Ø´ÛŒØ´Ù‡ Ø§Ù¾Ù„ÛŒ Ø¨Ø§ ÙˆØ¨ÛŒ) */
    .liquid-glass::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      opacity: var(--noise-opacity);
      mix-blend-mode: overlay;
    }

    /* Ù…Ø­ØªÙˆØ§ Ø±ÙˆÛŒ Ø´ÛŒØ´Ù‡ */
    .glass-content{
      position: relative;
      z-index: 1;
    }

    /* ===========================
       iOS Dock + Sheet demo
       =========================== */
    #dock{
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 14px;
      padding: 14px 18px;
      z-index: 1000;
    }
    .dock-btn{
      width: 52px;
      height: 52px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      font-size: 22px;
      background: rgba(255,255,255,0.16);
      box-shadow: 0 12px 22px rgba(0,0,0,0.16);
      transition: transform .18s cubic-bezier(.22,1.4,.36,1);
    }
    body.dark .dock-btn{ background: rgba(255,255,255,0.10); }
    .dock-btn:active{ transform: scale(0.92); }

    #backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.34);
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease;
      z-index: 900;
    }
    #backdrop.show{
      opacity: 1;
      pointer-events: auto;
    }

    #sheet{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 78vh;
      border-radius: 28px 28px 0 0;
      transform: translateY(100%);
      transition: transform .45s cubic-bezier(.22,1.35,.36,1);
      z-index: 950;
      display:flex;
      flex-direction: column;
    }
    #sheet.open{ transform: translateY(0); }

    .sheet-handle{
      width: 46px;
      height: 6px;
      border-radius: 8px;
      background: rgba(255,255,255,0.60);
      margin: 12px auto 8px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.25);
    }
    .sheet-title{
      text-align: center;
      font-size: 16px;
      opacity: .95;
      padding-bottom: 8px;
    }
    .sheet-list{
      list-style:none;
      padding: 0 16px 18px;
      margin: 0;
      overflow:auto;
      flex: 1;
    }
    .sheet-list li{
      padding: 14px 14px;
      margin: 9px 0;
      border-radius: 16px;
      background: rgba(255,255,255,0.14);
      box-shadow: 0 10px 18px rgba(0,0,0,0.10), inset 0 1px 0 rgba(255,255,255,0.18);
    }
    body.dark .sheet-list li{ background: rgba(255,255,255,0.08); }
  </style>
</head>

<body>

  <!-- SVG filter: Liquid glass refraction via turbulence + displacement -->
  <svg width="0" height="0" style="position:absolute">
    <filter id="liquidGlass" x="-20%" y="-20%" width="140%" height="140%" color-interpolation-filters="sRGB">
      <!-- Ù†Ù‚Ø´Ù‡ Ø´Ú©Ø³Øª Ù†ÙˆØ± -->
      <feTurbulence type="fractalNoise" baseFrequency="0.010 0.020" numOctaves="2" seed="8" result="noise"/>
      <!-- Ú©Ù…ÛŒ Ù†Ø±Ù… Ú©Ø±Ø¯Ù† Ù†Ù‚Ø´Ù‡ -->
      <feGaussianBlur in="noise" stdDeviation="1.2" result="noiseBlur"/>
      <!-- Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ÛŒÛŒ Ù¾ÛŒÚ©Ø³Ù„ÛŒ (refraction) -->
      <feDisplacementMap in="SourceGraphic" in2="noiseBlur" scale="22" xChannelSelector="R" yChannelSelector="G" result="disp"/>
      <!-- Ø´Ø§Ø±Ù¾/Ú©Ù†ØªØ±Ø§Ø³Øª Ù…Ù„Ø§ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ù„Ù†Ø² -->
      <feColorMatrix in="disp" type="matrix"
        values="
          1.08 0    0    0 0
          0    1.08 0    0 0
          0    0    1.08 0 0
          0    0    0    1 0" result="boost"/>
      <feGaussianBlur in="boost" stdDeviation="0.6" result="soft"/>
      <feBlend in="boost" in2="soft" mode="screen"/>
    </filter>
  </svg>

  <main>
    <h1>Liquid Glass (Ø¨Ø¯ÙˆÙ† Drag)</h1>
    <p>Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ â€œrefraction/displacementâ€ Ø±Ùˆ Ø¨Ø§ SVG filter Ø´Ø¨ÛŒÙ‡ Ù‡Ù…ÙˆÙ† CodePen Ù¾ÛŒØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù‡. ğŸ’¬ Ø±Ùˆ Ø¨Ø²Ù† ØªØ§ Sheet Ø¨Ø§Ø² Ø´Ù‡.</p>
    <p>Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ù‚ÛŒÙ‚ Ø´ÛŒØ´Ù‡: Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù† Ùˆ Ø¨Ø¨ÛŒÙ† Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ø§Ø®Ù„ Ø´ÛŒØ´Ù‡ â€œÙ„Ù†Ø²ÛŒâ€ Ù…ÛŒâ€ŒØ´Ù†.</p>
  </main>

  <!-- Dock -->
  <div id="dock" class="liquid-glass" data-glass>
    <div class="glass-sample" aria-hidden="true"></div>
    <div class="glass-content">
      <button class="dock-btn" id="homeBtn">ğŸ </button>
      <button class="dock-btn" id="openSheet">ğŸ’¬</button>
      <button class="dock-btn" id="toggleDark">ğŸŒ™</button>
    </div>
  </div>

  <div id="backdrop"></div>

  <!-- Bottom sheet -->
  <div id="sheet" class="liquid-glass" data-glass>
    <div class="glass-sample" aria-hidden="true"></div>
    <div class="glass-content">
      <div class="sheet-handle"></div>
      <div class="sheet-title">Ú¯ÙØªÚ¯ÙˆÙ‡Ø§</div>
      <ul class="sheet-list">
        <li>Conversation 001 â€” Intro</li>
        <li>Conversation 002 â€” At the bank</li>
        <li>Conversation 003 â€” Doctor appointment</li>
        <li>Conversation 004 â€” Renting a house</li>
        <li>Conversation 005 â€” Work interview</li>
        <li>Conversation 006 â€” Phone call</li>
      </ul>
    </div>
  </div>

  <script>
    // 1) Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯Øª displacement Ø¨Ø§ CSS var
    function syncFilterScale(){
      const scale = getComputedStyle(document.documentElement).getPropertyValue('--disp').trim() || '22';
      const disp = document.querySelector('#liquidGlass feDisplacementMap');
      if (disp) disp.setAttribute('scale', scale);
    }

    // 2) Ù‡Ù…â€ŒØªØ±Ø§Ø² Ú©Ø±Ø¯Ù† background Ø¯Ø§Ø®Ù„ Ø´ÛŒØ´Ù‡ Ø¨Ø§ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ØµÙØ­Ù‡
    //    (Ø¨Ø¯ÙˆÙ† dragØ› ÙÙ‚Ø· scroll/resize)
    const glassEls = [...document.querySelectorAll('[data-glass]')];

    function updateGlassSampling(){
      for (const el of glassEls){
        const sample = el.querySelector('.glass-sample');
        if (!sample) continue;

        // Ú†ÙˆÙ† background-attachment: fixed Ø§Ø³ØªØŒ Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª position Ø®ÛŒÙ„ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø´ÙˆØ¯ØŒ
        // Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ consistency (Ø¨Ø®ØµÙˆØµ Ø¨Ø±Ø®ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§) Ù…Ø§ Ù‡Ù…â€ŒØªØ±Ø§Ø²ÛŒ Ø±Ø§ Ù†Ú¯Ù‡ Ù…ÛŒâ€ŒØ¯Ø§Ø±ÛŒÙ…:
        const r = el.getBoundingClientRect();
        // Ù…Ù‚Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù†ÙÛŒ Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø·Ø±Ø­ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ø§Ø®Ù„ Ø´ÛŒØ´Ù‡ØŒ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù¾Ø´ØªØ´ align Ø´ÙˆØ¯
        sample.style.backgroundPosition = `${-r.left}px ${-r.top}px`;
      }
    }

    let raf = 0;
    function requestUpdate(){
      if (raf) return;
      raf = requestAnimationFrame(() => {
        raf = 0;
        syncFilterScale();
        updateGlassSampling();
      });
    }

    window.addEventListener('scroll', requestUpdate, {passive:true});
    window.addEventListener('resize', requestUpdate);
    window.addEventListener('orientationchange', requestUpdate);

    // init
    requestUpdate();

    // 3) Sheet open/close + iOS swipe down (elastic)
    const sheet = document.getElementById('sheet');
    const backdrop = document.getElementById('backdrop');

    document.getElementById('openSheet').onclick = () => {
      sheet.classList.add('open');
      backdrop.classList.add('show');
      requestUpdate();
    };

    function closeSheet(){
      sheet.classList.remove('open');
      backdrop.classList.remove('show');
      sheet.style.transform = '';
      requestUpdate();
    }
    backdrop.onclick = closeSheet;

    let startY = 0, dragging = false;
    sheet.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
      dragging = true;
    }, {passive:true});

    sheet.addEventListener('touchmove', (e) => {
      if (!dragging) return;
      const diff = e.touches[0].clientY - startY;
      if (diff > 0){
        sheet.style.transform = `translateY(${diff * 0.62}px)`;
      }
    }, {passive:true});

    sheet.addEventListener('touchend', (e) => {
      dragging = false;
      const diff = e.changedTouches[0].clientY - startY;
      if (diff > 120) closeSheet();
      else sheet.style.transform = '';
    }, {passive:true});

    // 4) Dark mode
    document.getElementById('toggleDark').onclick = () => {
      document.body.classList.toggle('dark');
      syncFilterScale();
      requestUpdate();
    };
  </script>
</body>
</html>